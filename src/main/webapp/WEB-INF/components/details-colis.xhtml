<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:panelGroup id="detailsModal">
        <div class="modal-overlay" id="details-modal-overlay" style="display: none;">
            <div class="bg-white rounded-lg w-full max-w-3xl max-h-[90vh] overflow-y-auto m-4 shadow-xl">

                <!-- Header -->
                <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center rounded-t-lg z-10">
                    <h3 class="text-lg font-semibold text-gray-800">Détails du colis</h3>
                    <button type="button" class="text-gray-400 hover:text-gray-600 transition" id="close-details-modal-btn" onclick="closeDetailsModal()">
                        <i class="ri-close-line text-2xl"></i>
                    </button>
                </div>

                <!-- Body -->
                <div class="p-6">

                    <!-- Header avec référence et statut -->
                    <div class="flex justify-between items-start mb-6 pb-4 border-b-2 border-gray-200">
                        <div>
                            <p class="text-xs text-gray-500 mb-1">Référence</p>
                            <p class="text-base font-semibold text-gray-800 font-mono">
                                <h:outputText value="#{colisBean.numeroSuivi}" />
                            </p>
                        </div>
                        <div>
                            <h:outputText value="Livré"
                                          styleClass="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800"
                                          rendered="#{colisBean.status.toString() eq 'LIVRE'}" />
                            <h:outputText value="En transit"
                                          styleClass="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-800"
                                          rendered="#{colisBean.status.toString() eq 'EN_TRANSIT'}" />
                            <h:outputText value="En attente"
                                          styleClass="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                                          rendered="#{colisBean.status.toString() eq 'EN_ATTENTE'}" />
                            <h:outputText value="Retourné"
                                          styleClass="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800"
                                          rendered="#{colisBean.status.toString() eq 'RETOURNE'}" />
                            <h:outputText value="Annulé"
                                          styleClass="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800"
                                          rendered="#{colisBean.status.toString() eq 'ANNULE'}" />
                        </div>
                    </div>

                    <!-- Informations générales -->
                    <div class="mb-6">
                        <h4 class="text-base font-semibold text-gray-800 mb-3 pb-2 border-b border-gray-200">
                            Informations générales
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <p class="text-xs text-gray-500 mb-1">Description</p>
                                <p class="text-sm text-gray-800">
                                    <h:outputText value="#{colisBean.description}" />
                                </p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 mb-1">Poids</p>
                                <p class="text-sm text-gray-800">
                                    <h:outputText value="#{colisBean.poids}">
                                        <f:convertNumber pattern="#0.00" />
                                    </h:outputText> kg
                                </p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 mb-1">Date d'envoi</p>
                                <p class="text-sm text-gray-800">
                                    <h:outputText value="#{colisBean.dateEnvoi}">
                                        <f:convertDateTime pattern="dd/MM/yyyy" />
                                    </h:outputText>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Adresse de livraison -->
                    <div class="mb-6">
                        <h4 class="text-base font-semibold text-gray-800 mb-3 pb-2 border-b border-gray-200">
                            Adresse de livraison
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-xs text-gray-500 mb-1">Rue</p>
                                <p class="text-sm text-gray-800">
                                    <h:outputText value="#{colisBean.rue}" />
                                </p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 mb-1">Ville</p>
                                <p class="text-sm text-gray-800">
                                    <h:outputText value="#{colisBean.ville}" />
                                </p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 mb-1">Code postal</p>
                                <p class="text-sm text-gray-800">
                                    <h:outputText value="#{colisBean.codePostal}" />
                                </p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 mb-1">Pays</p>
                                <p class="text-sm text-gray-800">
                                    <h:outputText value="#{colisBean.pays}" />
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Historique des statuts -->
                    <div class="mb-4">
                        <h4 class="text-base font-semibold text-gray-800 mb-3 pb-2 border-b border-gray-200">
                            Historique des statuts
                        </h4>
                        <div class="space-y-4">

                            <!-- Créé -->
                            <div class="flex gap-4 relative">
                                <div class="flex flex-col items-center">
                                    <div class="w-10 h-10 rounded-full flex items-center justify-center #{colisBean.hasStatus('CREE') ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-400'}">
                                        <i class="ri-add-circle-line text-lg"></i>
                                    </div>
                                    <div class="w-0.5 h-full bg-gray-200 mt-2"></div>
                                </div>
                                <div class="flex-1 pb-4">
                                    <h5 class="text-sm font-semibold text-gray-800">Créé</h5>
                                    <p class="text-xs text-gray-500 mt-1">
                                        <h:outputText value="#{colisBean.getStatusDate('CREE')}"
                                                      rendered="#{colisBean.hasStatus('CREE')}">
                                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                                        </h:outputText>
                                        <h:outputText value="—"
                                                      rendered="#{!colisBean.hasStatus('CREE')}" />
                                    </p>
                                </div>
                            </div>

                            <!-- En attente -->
                            <div class="flex gap-4 relative">
                                <div class="flex flex-col items-center">
                                    <div class="w-10 h-10 rounded-full flex items-center justify-center #{colisBean.hasStatus('EN_ATTENTE') ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-400'}">
                                        <i class="ri-time-line text-lg"></i>
                                    </div>
                                    <div class="w-0.5 h-full bg-gray-200 mt-2"></div>
                                </div>
                                <div class="flex-1 pb-4">
                                    <h5 class="text-sm font-semibold text-gray-800">En attente</h5>
                                    <p class="text-xs text-gray-500 mt-1">
                                        <h:outputText value="#{colisBean.getStatusDate('EN_ATTENTE')}"
                                                      rendered="#{colisBean.hasStatus('EN_ATTENTE')}">
                                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                                        </h:outputText>
                                        <h:outputText value="—"
                                                      rendered="#{!colisBean.hasStatus('EN_ATTENTE')}" />
                                    </p>
                                </div>
                            </div>

                            <!-- En transit -->
                            <div class="flex gap-4 relative">
                                <div class="flex flex-col items-center">
                                    <div class="w-10 h-10 rounded-full flex items-center justify-center #{colisBean.hasStatus('EN_TRANSIT') ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-400'}">
                                        <i class="ri-truck-line text-lg"></i>
                                    </div>
                                    <div class="w-0.5 h-full bg-gray-200 mt-2"></div>
                                </div>
                                <div class="flex-1 pb-4">
                                    <h5 class="text-sm font-semibold text-gray-800">En transit</h5>
                                    <p class="text-xs text-gray-500 mt-1">
                                        <h:outputText value="#{colisBean.getStatusDate('EN_TRANSIT')}"
                                                      rendered="#{colisBean.hasStatus('EN_TRANSIT')}">
                                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                                        </h:outputText>
                                        <h:outputText value="—"
                                                      rendered="#{!colisBean.hasStatus('EN_TRANSIT')}" />
                                    </p>
                                </div>
                            </div>

                            <!-- Livré -->
                            <div class="flex gap-4 relative">
                                <div class="flex flex-col items-center">
                                    <div class="w-10 h-10 rounded-full flex items-center justify-center #{colisBean.hasStatus('LIVRE') ? 'bg-emerald-600 text-white' : 'bg-gray-200 text-gray-400'}">
                                        <i class="ri-check-double-line text-lg"></i>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <h5 class="text-sm font-semibold text-gray-800">Livré</h5>
                                    <p class="text-xs text-gray-500 mt-1">
                                        <h:outputText value="#{colisBean.getStatusDate('LIVRE')}"
                                                      rendered="#{colisBean.hasStatus('LIVRE')}">
                                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                                        </h:outputText>
                                        <h:outputText value="—"
                                                      rendered="#{!colisBean.hasStatus('LIVRE')}" />
                                    </p>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>

                <!-- Footer -->
                <div class="sticky bottom-0 bg-gray-50 px-6 py-4 flex justify-end border-t border-gray-200 rounded-b-lg">
                    <button type="button"
                            class="px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition text-sm font-medium"
                            id="close-details-btn"
                            onclick="closeDetailsModal()">
                        Fermer
                    </button>
                </div>

            </div>
        </div>
    </h:panelGroup>

    <script type="text/javascript">
        function closeDetailsModal() {
            const overlay = document.getElementById("details-modal-overlay");
            if (overlay) {
                overlay.classList.remove("show");
                overlay.style.display = "none";
                document.body.style.overflow = "";
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            const overlay = document.getElementById("details-modal-overlay");

            // Fermer en cliquant sur l'overlay
            if (overlay) {
                overlay.addEventListener("click", function(e) {
                    if (e.target === overlay) {
                        closeDetailsModal();
                    }
                });
            }

            // Fermer avec la touche Échap
            document.addEventListener("keydown", function(e) {
                if (e.key === "Escape" &amp;&amp; overlay &amp;&amp; overlay.style.display === "flex") {
                    closeDetailsModal();
                }
            });
        });
    </script>

</ui:composition>