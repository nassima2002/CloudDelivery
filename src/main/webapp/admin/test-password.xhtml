<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <title>Test Mot de Passe</title>
    <meta charset="UTF-8" />
    <script src="https://cdn.tailwindcss.com"></script>
</h:head>
<h:body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8">
        <h1 class="text-3xl font-bold mb-6 text-blue-600">üß™ Test Syst√®me de Mot de Passe</h1>

        <h:form>
            <!-- Test Hashage -->
            <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                <h2 class="text-xl font-semibold mb-4">1Ô∏è‚É£ Test Hashage</h2>

                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">Mot de passe en clair:</label>
                    <h:inputText value="#{passwordTestBean.plainPassword}"
                                 styleClass="w-full px-4 py-2 border rounded-lg"
                                 placeholder="Ex: 123456" />
                </div>

                <h:commandButton value="üîí Hasher le mot de passe"
                                 action="#{passwordTestBean.testHash}"
                                 styleClass="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                    <f:ajax execute="@form" render="@form" />
                </h:commandButton>
            </div>

            <!-- Test V√©rification -->
            <div class="mb-6 p-4 bg-green-50 rounded-lg">
                <h2 class="text-xl font-semibold mb-4">2Ô∏è‚É£ Test V√©rification</h2>

                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">Hash BCrypt:</label>
                    <h:inputTextarea value="#{passwordTestBean.hashedPassword}"
                                     styleClass="w-full px-4 py-2 border rounded-lg font-mono text-sm"
                                     rows="3"
                                     placeholder="Collez un hash BCrypt ici" />
                </div>

                <h:commandButton value="‚úÖ V√©rifier"
                                 action="#{passwordTestBean.testVerify}"
                                 styleClass="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg">
                    <f:ajax execute="@form" render="@form" />
                </h:commandButton>
            </div>

            <!-- R√©sultat -->
            <h:panelGroup rendered="#{passwordTestBean.testResult != null}">
                <div class="p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded-lg">
                    <h3 class="font-semibold mb-2">üìã R√©sultat:</h3>
                    <pre class="whitespace-pre-wrap font-mono text-sm">#{passwordTestBean.testResult}</pre>
                </div>
            </h:panelGroup>
        </h:form>

        <!-- Instructions -->
        <div class="mt-8 p-4 bg-gray-50 rounded-lg">
            <h3 class="font-semibold mb-2">üìñ Instructions:</h3>
            <ol class="list-decimal list-inside space-y-2 text-sm text-gray-700">
                <li>Entrez le mot de passe que vous utilisez pour cr√©er le livreur (ex: 123456)</li>
                <li>Cliquez sur "Hasher le mot de passe"</li>
                <li>Le hash g√©n√©r√© appara√Ætra dans le champ "Hash BCrypt"</li>
                <li>Cliquez sur "V√©rifier" pour tester la v√©rification</li>
                <li>V√©rifiez les logs serveur pour plus de d√©tails</li>
            </ol>
        </div>

        <!-- V√©rification manuelle en base -->
        <div class="mt-4 p-4 bg-red-50 rounded-lg">
            <h3 class="font-semibold mb-2">üóÑÔ∏è V√©rification en base de donn√©es:</h3>
            <p class="text-sm text-gray-700 mb-2">Ex√©cutez cette requ√™te SQL pour v√©rifier:</p>
            <pre class="bg-gray-800 text-green-400 p-3 rounded text-xs overflow-x-auto">SELECT u.id, u.email, u.nom, u.prenom,
       LENGTH(u.motDePasse) as longueur_hash,
       SUBSTRING(u.motDePasse, 1, 20) as debut_hash,
       CASE
         WHEN u.motDePasse LIKE '$2a$%'
           OR u.motDePasse LIKE '$2b$%'
         THEN 'BCrypt valide'
         ELSE 'Format invalide'
       END as format_hash
FROM Utilisateur u
WHERE u.role = 'LIVREUR'
ORDER BY u.id DESC;</pre>
        </div>
    </div>
</h:body>
</html>